================================================================================
5G NETWORK SLICING RL å°ˆæ¡ˆæ¨¡çµ„åŒ–è©³ç´°èªªæ˜
================================================================================

ç›®éŒ„ï¼š
1. æ•´é«”æ¶æ§‹æ¦‚è¦½
2. é…ç½®å±¤ (Configuration Layer)
3. å·¥å…·å±¤ (Utility Layer)
4. ç‰©ç†å±¤æ¨¡æ“¬æ ¸å¿ƒ (Physical Layer Simulation Core)
5. RL ç’°å¢ƒå±¤ (Reinforcement Learning Interface)
6. æ‡‰ç”¨å±¤ (Application/Training Layer)
7. æ¨¡çµ„ä¾è³´é—œä¿‚åœ–
8. æ¨¡çµ„é–“æ•¸æ“šæµ
9. å„æ¨¡çµ„è²¬ä»»æ¸…å–®
10. æ¨¡çµ„é–‹ç™¼é †åºå»ºè­°
11. æ¨¡çµ„äº’å‹•ç¯„ä¾‹

================================================================================
1. æ•´é«”æ¶æ§‹æ¦‚è¦½
================================================================================

5G_Slicing_RL/
â”œâ”€â”€ ã€é…ç½®å±¤ã€‘
â”‚   â””â”€â”€ configs/
â”‚       â””â”€â”€ default_config.yaml
â”‚
â”œâ”€â”€ ã€æ‡‰ç”¨å±¤ã€‘
â”‚   â”œâ”€â”€ main.py (è¨“ç·´å…¥å£)
â”‚   â”œâ”€â”€ evaluate.py (è©•ä¼°èˆ‡æ¸¬è©¦)
â”‚   â””â”€â”€ tune_optuna.py (è¶…åƒæ•¸èª¿å„ª)
â”‚
â”œâ”€â”€ ã€å¼·åŒ–å­¸ç¿’å±¤ã€‘
â”‚   â””â”€â”€ src/envs/
â”‚       â””â”€â”€ slicing_env.py (Gym ç’°å¢ƒ)
â”‚
â”œâ”€â”€ ã€ç‰©ç†å±¤æ¨¡æ“¬æ ¸å¿ƒã€‘
â”‚   â””â”€â”€ src/core/
â”‚       â”œâ”€â”€ traffic.py (æµé‡ç”Ÿæˆ)
â”‚       â”œâ”€â”€ channel.py (é€šé“æ¨¡æ“¬)
â”‚       â”œâ”€â”€ buffers.py (ç·©è¡ç®¡ç†)
â”‚       â””â”€â”€ base_station.py (åŸºåœ°å°å¼•æ“)
â”‚
â””â”€â”€ ã€å·¥å…·å±¤ã€‘
    â””â”€â”€ src/utils/
        â”œâ”€â”€ constants.py (ç‰©ç†å¸¸æ•¸)
        â””â”€â”€ plotter.py (åœ–è¡¨ç”Ÿæˆ)

================================================================================
2. é…ç½®å±¤ (Configuration Layer)
================================================================================

æª”æ¡ˆï¼šconfigs/default_config.yaml

è²¬ä»»ï¼šé›†ä¸­ç®¡ç†æ‰€æœ‰å¯¦é©—åƒæ•¸

æ¨¡çµ„ç‰¹é»ï¼š
  - ç’°å¢ƒåƒæ•¸ï¼šæµé‡è² è¼‰ï¼ˆeMBB 300 Mbps, URLLC 15 Mbpsï¼‰
  - RL è¶…åƒæ•¸ï¼šå­¸ç¿’ç‡ã€Gammaã€Batch Size
  - çå‹µå‡½æ•¸æ¬Šé‡ï¼šw_throughputã€w_latencyã€drop_penalty
  - ç³»çµ±è·¯å¾‘ï¼šLogã€Modelã€Result è¼¸å‡ºä½ç½®

ä¾è³´ï¼šNoneï¼ˆç´”æ•¸æ“šï¼‰
è¢«ä¾è³´ï¼šæ‰€æœ‰åŸ·è¡Œè…³æœ¬éƒ½éœ€è®€å–æ­¤æª”

é—œéµåƒæ•¸ç¤ºä¾‹ï¼š

traffic:
  embb_arrival_rate_mbps: 300.0      # eMBB æµé‡
  urllc_arrival_rate_mbps: 15.0      # URLLC æµé‡

agent:
  learning_rate: 0.0003              # SAC å­¸ç¿’ç‡
  gamma: 0.99                         # æŠ˜æ‰£å› å­
  batch_size: 256                     # ç¶“é©—å›æ”¾æ‰¹æ¬¡

reward:
  w_throughput: 0.00001              # ååé‡çå‹µæ¬Šé‡
  w_latency: 0.01                    # å»¶é²æ‡²ç½°æ¬Šé‡

================================================================================
3. å·¥å…·å±¤ (Utility Layer)
================================================================================

================================================================================
3.1 src/utils/constants.py (åŸºç¤æ¨¡çµ„) â­
================================================================================

è²¬ä»»ï¼šå®šç¾© 5G ç‰©ç†å±¤æ‰€æœ‰å¸¸æ•¸èˆ‡è¦ç¯„
é‡è¦æ€§ï¼šæ˜¯æ•´å€‹ç³»çµ±çš„ã€Œæ†²æ³•ã€ï¼Œå…¶ä»–æ¨¡çµ„éƒ½ä¾è³´æ–¼æ­¤

é—œéµå¸¸æ•¸ï¼š

SYSTEM_BANDWIDTH_MHZ       = 100    | ç¸½é »å¯¬ (5G NR æ¨™æº–)
SCS_KHZ                    = 30     | å­è¼‰æ³¢é–“éš” (Numerology 1)
TTI_DURATION_MS            = 0.5    | å‚³è¼¸æ™‚é–“é–“éš”
TTI_DURATION_SEC           = 0.0005 | TTI (ç§’)
TOTAL_RBS                  = 273    | ç¸½è³‡æºå¡Šæ•¸ (3GPP è¨ˆç®—)
SUBCARRIERS_PER_RB         = 12     | æ¯å€‹ RB çš„å­è¼‰æ³¢æ•¸
SYMBOLS_PER_SLOT           = 14     | æ¯å€‹æ§½çš„ OFDM ç¬¦è™Ÿæ•¸
RES_PER_RB                 = 168    | æ¯å€‹ RB çš„è³‡æºå…ƒç´  (12Ã—14)
CONTROL_OVERHEAD_FACTOR    = 0.86   | æ§åˆ¶è¨Šè™Ÿé–‹éŠ·å› å­

MCS æ˜ å°„è¡¨ï¼š

CQI_TO_EFFICIENCY å­—å…¸ï¼š
  1   : 0.1523    | QPSK (æœ€å·®æ”¶è¨Š)
  7   : 1.4766    | 16QAM
  10  : 2.7305    | 64QAM
  15  : 5.5547    | 256QAM (æœ€ä½³æ”¶è¨Š)

QoS éœ€æ±‚ï¼š

URLLC_MAX_LATENCY_MS       = 1.0    | URLLC 1ms æœ€å¾ŒæœŸé™
PACKET_SIZE_EMBB_BYTES     = 1500   | eMBB 1500 Bytes
PACKET_SIZE_URLLC_BYTES    = 32     | URLLC 32 Bytes
MAX_CQI                    = 15     | CQI æœ€å¤§å€¼
MIN_CQI                    = 0      | CQI æœ€å°å€¼

è¢«ä¾è³´æƒ…æ³ï¼š
  - traffic.py â†’ ä½¿ç”¨ TTI_DURATION_SECã€PACKET_SIZE_*
  - buffers.py â†’ ä½¿ç”¨ URLLC_MAX_LATENCY_MS
  - channel.py â†’ ä½¿ç”¨ CQI_TO_EFFICIENCYã€MAX_CQI
  - base_station.py â†’ ä½¿ç”¨æ‰€æœ‰ RB ç›¸é—œå¸¸æ•¸

================================================================================
3.2 src/utils/plotter.py
================================================================================

è²¬ä»»ï¼šç”Ÿæˆè«–æ–‡ç´šå¯è¦–åŒ–åœ–è¡¨

ä¸»è¦å‡½æ•¸ï¼š

def plot_evaluation_results(df: DataFrame, save_dir: str)

è¼¸å‡ºåœ–è¡¨ï¼š

  1. throughput_time.png
     - ååé‡æ™‚é–“åºåˆ—ï¼ˆç§»å‹•å¹³å‡ï¼‰
     - é¡¯ç¤º eMBB èˆ‡ URLLC çš„å‹•æ…‹åˆ†é…

  2. rb_allocation.png
     - RB å †ç–Šé¢ç©åœ–ï¼ˆå‹•æ…‹è³‡æºåˆ†é…ï¼‰
     - é¡¯ç¤ºéš¨æ™‚é–“çš„è³‡æºåˆ†é…è®ŠåŒ–

  3. latency_cdf.png
     - URLLC å»¶é² CDFï¼ˆé—œéµ KPIï¼‰
     - é¡¯ç¤ºæœ‰å¤šå°‘æ¯”ä¾‹çš„å°åŒ…æ»¿è¶³ 1ms è¦æ±‚

ä¾è³´ï¼špandas, matplotlib, seaborn
è¢«ä¾è³´ï¼ševaluate.py

================================================================================
4. ç‰©ç†å±¤æ¨¡æ“¬æ ¸å¿ƒ (Physical Layer Simulation Core)
================================================================================

================================================================================
4.1 src/core/traffic.py
================================================================================

è²¬ä»»ï¼šæ¨¡æ“¬éš¨æ©Ÿå°åŒ…åˆ°é”éç¨‹
æ¨¡å‹ï¼šPoisson åˆ†ä½ˆï¼ˆç¾å¯¦ç¶²è·¯æµé‡æ¨™æº–å‡è¨­ï¼‰

é—œéµæ–¹æ³•ï¼š

class TrafficGenerator:
    def __init__(self, arrival_rate_mbps, packet_size_bytes):
        # Lambda = (Mbps Ã— 10^6 Ã— TTI_duration) / packet_size_bits
        self.lam = (arrival_rate_mbps * 1e6 * TTI_DURATION_SEC) / packet_size_bits
    
    def step(self) -> (num_packets, total_bits):
        # å¾ Poisson(Lambda) æ¡æ¨£
        num_packets = np.random.poisson(self.lam)
        return num_packets, num_packets * self.packet_size_bits

ç‰©ç†æ„ç¾©ï¼š

eMBB (300 Mbps, 1500 Bytes):
  Lambda_eMBB = (300 Ã— 10^6 Ã— 0.0005) / 12000 = 12.5 packets/TTI

URLLC (15 Mbps, 32 Bytes):
  Lambda_URLLC = (15 Ã— 10^6 Ã— 0.0005) / 256 = 29.3 packets/TTI

è¢«ä¾è³´ï¼šbase_station.py

================================================================================
4.2 src/core/channel.py
================================================================================

è²¬ä»»ï¼šæ¨¡æ“¬ç„¡ç·šé€šé“å“è³ªå‹•æ…‹è®ŠåŒ–
æ¨¡å‹ï¼šé™åˆ¶éš¨æ©ŸéŠèµ° (Bounded Random Walk)

é—œéµæ–¹æ³•ï¼š

class ChannelSimulator:
    def step(self) -> np.ndarray:
        # 90% ä¿æŒä¸è®Šï¼Œ10% æ©Ÿç‡ Â±1
        change_mask = np.random.random(num_ues) < 0.10
        directions = np.random.choice([-1, 1], size=num_ues)
        self.current_cqis += (change_mask * directions)
        return np.clip(self.current_cqis, 1, 15)

def get_efficiency(cqi: int) -> float:
    # CQI æŸ¥è¡¨å–å¾—é »è­œæ•ˆç‡
    return CQI_TO_EFFICIENCY[cqi]

åƒæ•¸èªªæ˜ï¼š

èšåˆ CQIï¼š
  - 2 å€‹é‚è¼¯ç”¨æˆ¶ï¼ˆeMBB èˆ‡ URLLC çš„å¹³å‡ï¼‰
  - é¿å…ç‹€æ…‹ç©ºé–“çˆ†ç‚¸

æ™‚è®Šç‰¹æ€§ï¼š
  - æ¨¡æ“¬æ…¢è¡°è½ç’°å¢ƒï¼ˆå¤§éƒ¨åˆ†æ™‚é–“ç©©å®šï¼Œå¶çˆ¾è®ŠåŒ–ï¼‰
  - 90% ä¿æŒã€10% æ³¢å‹•çš„æ¨¡å¼

è¢«ä¾è³´ï¼šbase_station.py

================================================================================
4.3 src/core/buffers.py
================================================================================

è²¬ä»»ï¼šå¯¦ç¾ FIFO ä½‡åˆ—èˆ‡è¶…æ™‚æª¢æŸ¥æ©Ÿåˆ¶
ç‰¹æ€§ï¼šHead-of-Line (HoL) å»¶é²è¿½è¹¤

é—œéµæ–¹æ³•ï¼š

class SliceBuffer:
    
    def add_packet(self, size_bits: int, arrival_time: float):
        # åŠ å…¥ä½‡åˆ—å°¾ç«¯ï¼Œè¨˜éŒ„åˆ°é”æ™‚é–“
        packet = {'size': size_bits, 'arrival_time': arrival_time}
        self.queue.append(packet)
    
    def remove_packets(self, capacity_bits: float, current_time: float) 
        -> (transmitted_bits, latencies):
        # å¾ä½‡åˆ—é ­éƒ¨å‚³é€å°åŒ…ï¼Œç›´åˆ°å®¹é‡è€—ç›¡
        # è¿”å›å‚³å‡ºä½å…ƒæ•¸èˆ‡æ¯å€‹å°åŒ…çš„å»¶é²
    
    def check_timeout(self, current_time: float) -> dropped_count:
        # (URLLC å°ˆç”¨) ä¸Ÿæ£„è¶…é 1ms çš„å°åŒ…
    
    def get_state(current_time):
        return [queue_load_bits, hol_delay_seconds]

ç‹€æ…‹æŒ‡æ¨™ï¼š

get_state() å›å‚³ 2 ç¶­å‘é‡ï¼š
  [1] Queue Load Bits
      - ç·©è¡å€è£¡é‚„æœ‰å¤šå°‘ bits
  [2] HoL Delay (Seconds)
      - éšŠé ­æœ€èˆŠå°åŒ…çš„å»¶é²

è¢«ä¾è³´ï¼šbase_station.py

================================================================================
4.4 src/core/base_station.py (æ ¸å¿ƒå¼•æ“) â­
================================================================================

è²¬ä»»ï¼šæ•´åˆæ‰€æœ‰ç‰©ç†å±¤çµ„ä»¶ï¼ŒåŸ·è¡ŒåŸºåœ°å°æ¨¡æ“¬
åœ°ä½ï¼šæ•´å€‹æ¨¡æ“¬ç³»çµ±çš„å¤§è…¦

æ¶æ§‹ï¼š

class BaseStation:
    def __init__(self, config):
        self.channel = ChannelSimulator()        # é€šé“å“è³ª
        self.traffic_embb = TrafficGenerator()   # eMBB æµé‡
        self.traffic_urllc = TrafficGenerator()  # URLLC æµé‡
        self.buffer_embb = SliceBuffer()         # eMBB ä½‡åˆ—
        self.buffer_urllc = SliceBuffer()        # URLLC ä½‡åˆ—

å–®å€‹ TTI çš„åŸ·è¡Œæµç¨‹ï¼š

def step(self, action_weights) -> info_dict:
    
    # 1. æ™‚é–“æ¨é€²
    cqis = self.channel.step()                   # CQI æ³¢å‹•
    _, bits_embb = self.traffic_embb.step()      # eMBB æµé‡åˆ°é”
    _, bits_urllc = self.traffic_urllc.step()    # URLLC æµé‡åˆ°é”
    
    # 2. åŠ å…¥ Buffer
    self.buffer_embb.add_packet(bits_embb, self.current_time)
    self.buffer_urllc.add_packet(bits_urllc, self.current_time)
    
    # 3. è³‡æºåˆ†é… (RL Agent å‹•ä½œ)
    w_embb, w_urllc = normalize(action_weights)
    num_rbs_embb = int(273 * w_embb)
    num_rbs_urllc = 273 - num_rbs_embb
    
    # 4. å®¹é‡è¨ˆç®—ï¼ˆç‰©ç†å±¤å…¬å¼ï¼‰
    eff_embb = get_efficiency(cqis[0])
    cap_embb = num_rbs_embb * 168 * eff_embb * 0.86
    
    eff_urllc = get_efficiency(cqis[1])
    cap_urllc = num_rbs_urllc * 168 * eff_urllc * 0.86
    
    # 5. å‚³è¼¸
    tx_bits_embb, delays_embb = self.buffer_embb.remove_packets(cap_embb, self.current_time)
    tx_bits_urllc, delays_urllc = self.buffer_urllc.remove_packets(cap_urllc, self.current_time)
    
    # 6. é•è¦æª¢æŸ¥
    dropped_urllc = self.buffer_urllc.check_timeout(self.current_time)
    
    # 7. è¿”å›çµ±è¨ˆ
    return {
        'throughput_embb_mbps': tx_bits_embb / TTI_DURATION_SEC / 1e6,
        'throughput_urllc_mbps': tx_bits_urllc / TTI_DURATION_SEC / 1e6,
        'latency_urllc': np.mean(delays_urllc) if delays_urllc else 0,
        'dropped_urllc': dropped_urllc,
        'rbs_embb': num_rbs_embb,
        'cqi_embb': cqis[0],
        ...
    }

ç‰©ç†å±¤å…¬å¼è§£æï¼š

Capacity (bits) = RBs Ã— REs/RB Ã— Efficiency Ã— Overhead
                = 163 Ã— 168 Ã— 4.52 Ã— 0.86 â‰ˆ 106,234 bits/TTI

è¢«ä¾è³´ï¼šslicing_env.py

================================================================================
5. RL ç’°å¢ƒå±¤ (Reinforcement Learning Interface)
================================================================================

================================================================================
5.1 src/envs/slicing_env.py (Gym æ¨™æº–ä»‹é¢) â­
================================================================================

è²¬ä»»ï¼šå°‡ç‰©ç†å±¤æ¨¡æ“¬è½‰æ›ç‚º Gym ç’°å¢ƒï¼Œä¾› RL Agent è¨“ç·´

Gym æ¨™æº–ä»‹é¢ï¼š

class NetworkSlicingEnv(gym.Env):
    
    # ç‹€æ…‹ç©ºé–“ (6 ç¶­)
    observation_space = Box(
        low=[0,0,0,0,0,0], 
        high=[âˆ,âˆ,âˆ,âˆ,15,15]
    )
    # [eMBB_Load, eMBB_HoL, URLLC_Load, URLLC_HoL, CQI_eMBB, CQI_URLLC]
    
    # å‹•ä½œç©ºé–“ (2 ç¶­é€£çºŒ)
    action_space = Box(low=0.0, high=1.0, shape=(2,))
    # [w_eMBB, w_URLLC]
    
    def reset(self):
        # é‡ç½®ç’°å¢ƒï¼Œè¿”å›åˆå§‹ç‹€æ…‹
        return obs, info
    
    def step(self, action) -> (obs, reward, terminated, truncated, info):
        # åŸ·è¡Œä¸€æ­¥ï¼Œè¿”å›æ¨™æº– Gym è¼¸å‡º

çå‹µå‡½æ•¸è¨­è¨ˆï¼š

def step(self, action):
    info = self.bs.step(action)  # ç‰©ç†å±¤è¨ˆç®—
    
    # çå‹µ = ååé‡ - å»¶é²æ‡²ç½° - ä¸ŸåŒ…æ‡²ç½°
    reward = (w_throughput * (Thr_eMBB + Thr_URLLC)
              - w_latency * Latency_URLLC_ms
              - drop_penalty * Dropped_URLLC)
    
    return obs, reward, terminated, truncated, info

è¨­è¨ˆç›®æ¨™ï¼š
  1. æœ€å¤§åŒ–ç¸½ååé‡ï¼ˆeMBB + URLLCï¼‰
  2. æœ€å°åŒ– URLLC å»¶é²ï¼ˆæ¥è¿‘ 1ms æ™‚æ‡²ç½°åŠ é‡ï¼‰
  3. åš´æ‡² URLLC ä¸ŸåŒ…ï¼ˆSLA é•è¦ï¼‰

è¢«ä¾è³´ï¼šmain.py, evaluate.py, tune_optuna.py

================================================================================
6. æ‡‰ç”¨å±¤ (Application/Training Layer)
================================================================================

================================================================================
6.1 main.py (è¨“ç·´å…¥å£) ğŸ¯
================================================================================

è²¬ä»»ï¼šä¸»è¨“ç·´ç¨‹åºï¼Œå”èª¿ç’°å¢ƒã€Agentã€å›èª¿å‡½æ•¸

åŸ·è¡Œæµç¨‹ï¼š

def main():
    # 1. è¼‰å…¥é…ç½®
    config = load_config("configs/default_config.yaml")
    
    # 2. å»ºç«‹ç’°å¢ƒ
    train_env = NetworkSlicingEnv(config)
    eval_env = NetworkSlicingEnv(config)
    
    # 3. åˆå§‹åŒ– Agent (SAC)
    model = SAC("MlpPolicy", train_env,
                learning_rate=0.0003,
                gamma=0.99,
                buffer_size=50000)
    
    # 4. å®šæœŸè©•ä¼°å›èª¿
    eval_callback = EvalCallback(
        eval_env,
        eval_freq=2000,
        best_model_save_path="./models/"
    )
    
    # 5. è¨“ç·´ (200k steps)
    model.learn(
        total_timesteps=200000,
        callback=eval_callback
    )
    
    # 6. å­˜æª”
    model.save("./models/final_model.zip")

é—œéµçµ„ä»¶ï¼š
  - Monitorï¼šè¨˜éŒ„ Episode çå‹µèˆ‡é•·åº¦
  - EvalCallbackï¼šæ¯ 2000 æ­¥è©•ä¼°ä¸€æ¬¡ï¼Œä¿å­˜æœ€ä½³æ¨¡å‹
  - TensorBoardï¼šå¯¦æ™‚ç›£æ§è¨“ç·´æ›²ç·š

ä¾è³´ï¼šslicing_env.py, default_config.yaml

================================================================================
6.2 evaluate.py (è©•ä¼°èˆ‡é©—è­‰) ğŸ“Š
================================================================================

è²¬ä»»ï¼šè¼‰å…¥è¨“ç·´æ¨¡å‹ï¼Œè©•ä¼°æ€§èƒ½ï¼Œç”Ÿæˆè«–æ–‡åœ–è¡¨

åŸ·è¡Œæµç¨‹ï¼š

def evaluate():
    # 1. è¼‰å…¥æœ€ä½³æ¨¡å‹
    model = SAC.load("models/best_model.zip")
    env = NetworkSlicingEnv(config)
    
    # 2. é‹è¡Œ 2000 æ­¥æ¨è«–
    obs, _ = env.reset()
    history = []
    for step in range(2000):
        action, _ = model.predict(obs, deterministic=True)
        obs, reward, _, _, info = env.step(action)
        history.append(info)
    
    # 3. è¨ˆç®— KPIs
    df = pd.DataFrame(history)
    avg_embb = df['throughput_embb_mbps'].mean()      # ~300 Mbps
    avg_urllc = df['throughput_urllc_mbps'].mean()    # ~15 Mbps
    violation_rate = (df['dropped_urllc'] > 0).mean() # æ‡‰ < 0.1%
    
    # 4. ç¹ªåœ–
    plot_evaluation_results(df, "./results/")

è¼¸å‡ºæŒ‡æ¨™ï¼š
  - Throughput time series (ååé‡æ™‚åº)
  - RB allocation history (è³‡æºåˆ†é…æ­·å²)
  - URLLC latency CDF (å»¶é²ç´¯ç©åˆ†ä½ˆ)
  - Violation rate (é•è¦ç‡)

ä¾è³´ï¼šslicing_env.py, plotter.py

================================================================================
6.3 tune_optuna.py (è¶…åƒæ•¸è‡ªå‹•èª¿å„ª) ğŸ”
================================================================================

è²¬ä»»ï¼šä½¿ç”¨ Optuna æœç´¢æœ€ä½³è¶…åƒæ•¸çµ„åˆ

æœç´¢ç©ºé–“ï¼š

# SAC æ ¸å¿ƒåƒæ•¸
learning_rate âˆˆ [5e-5, 1e-3]     # log scale
gamma âˆˆ [0.90, 0.995]
batch_size âˆˆ {128, 256, 512}
buffer_size âˆˆ {50k, 100k, 200k}

# ç¥ç¶“ç¶²è·¯æ¶æ§‹
n_layers âˆˆ {2, 3}
neurons_per_layer âˆˆ {128, 256, 512}

# ç†µèª¿ç¯€
ent_coef âˆˆ {auto, [0.001, 0.5]}

å„ªåŒ–ç­–ç•¥ï¼š
  - TPE Samplerï¼šå‰ 10 å€‹ trial éš¨æ©Ÿæ¢ç´¢ï¼Œå¾ŒçºŒæ ¹æ“šæ­·å²å„ªåŒ–æ¡æ¨£
  - Median Prunerï¼šè‡ªå‹•æå‰çµ‚æ­¢è¡¨ç¾ä¸å¥½çš„ trial
  - ä¸¦è¡ŒåŒ–ï¼šæ”¯æ´ 8 æ ¸å¿ƒä¸¦è¡ŒåŸ·è¡Œ

åŸ·è¡Œç¯„ä¾‹ï¼š

# å–®æ ¸å¿ƒ (æ¸¬è©¦ç”¨)
python tune_optuna.py --n-trials 20

# 8æ ¸å¿ƒä¸¦è¡Œ (100 æ¬¡æœç´¢)
python tune_optuna.py --n-trials 100 --n-jobs 8

# èƒŒæ™¯åŸ·è¡Œ
nohup python tune_optuna.py --n-trials 200 --n-jobs 16 > tune.log 2>&1 &

è¼¸å‡ºï¼š
  - optuna_history.htmlï¼šå„ªåŒ–è»Œè·¡
  - optuna_importance.htmlï¼šè¶…åƒæ•¸é‡è¦æ€§æ’åº
  - best_config_optuna.yamlï¼šæœ€ä½³é…ç½®

ä¾è³´ï¼šslicing_env.py, default_config.yaml

================================================================================
7. æ¨¡çµ„ä¾è³´é—œä¿‚åœ–
================================================================================

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   configs/default_config.yaml           â”‚
â”‚   (æ‰€æœ‰åƒæ•¸çš„å–®ä¸€æºé ­)                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”
        â”‚             â”‚
        â†“             â†“
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚           src/utils/ (å·¥å…·å±¤)                              â”‚
   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
   â”‚  â”‚ constants.py â­  â”‚    â”‚   plotter.py     â”‚              â”‚
   â”‚  â”‚ (ç‰©ç†å®šå¾‹)       â”‚    â”‚ (è¦–è¦ºåŒ–å·¥å…·)      â”‚              â”‚
   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚                        â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”
        â”‚                                       â”‚
        â†“                                       â†“
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚        src/core/ (ç‰©ç†å±¤æ¨¡æ“¬æ ¸å¿ƒ)                            â”‚
   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
   â”‚  â”‚ traffic.py   â”‚  â”‚ channel.py   â”‚  â”‚ buffers.py   â”‚       â”‚
   â”‚  â”‚ (æµé‡ç”Ÿæˆ)   â”‚  â”‚ (é€šé“å“è³ª)   â”‚  â”‚ (ä½‡åˆ—ç®¡ç†)   â”‚       â”‚
   â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
   â”‚         â”‚                 â”‚                 â”‚               â”‚
   â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
   â”‚                           â”‚                                 â”‚
   â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â†“â”€â”€â”€â”€â”€â”€â”                          â”‚
   â”‚                    â”‚base_station â”‚                          â”‚
   â”‚                    â”‚ .py (å¼•æ“) â­ â”‚                          â”‚
   â”‚                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                          â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                                 â†“
                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                     â”‚  src/envs/            â”‚
                     â”‚ slicing_env.py â­    â”‚
                     â”‚ (Gym æ¨™æº–ä»‹é¢)       â”‚
                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚            â”‚            â”‚
                    â†“            â†“            â†“
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚  main.py     â”‚ evaluate.py  â”‚tune_optuna   â”‚
            â”‚  (è¨“ç·´)       â”‚  (è©•ä¼°)      â”‚.py (èª¿å„ª)    â”‚
            â”‚              â”‚              â”‚              â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

================================================================================
8. æ¨¡çµ„é–“æ•¸æ“šæµ
================================================================================

ã€è¨“ç·´æµç¨‹ã€‘

main.py
  â”œâ”€ è®€å–: default_config.yaml
  â”œâ”€ å»ºç«‹: NetworkSlicingEnv
  â”‚   â”œâ”€ è®€å–: config['traffic'], config['reward']
  â”‚   â””â”€ å»ºç«‹: BaseStation
  â”‚       â”œâ”€ å»ºç«‹: TrafficGenerator (ä½¿ç”¨ constants)
  â”‚       â”œâ”€ å»ºç«‹: ChannelSimulator (ä½¿ç”¨ constants)
  â”‚       â””â”€ å»ºç«‹: SliceBuffer 
  â”œâ”€ è¨“ç·´: SAC Agent
  â”‚   â”œâ”€ æ¯æ­¥å‘¼å« env.step(action)
  â”‚   â”‚   â”œâ”€ å‘¼å« bs.step(action)
  â”‚   â”‚   â”‚   â”œâ”€ traffic.step() â†’ bits_arrived
  â”‚   â”‚   â”‚   â”œâ”€ channel.step() â†’ cqis
  â”‚   â”‚   â”‚   â”œâ”€ buffers.remove_packets() â†’ throughput, latency
  â”‚   â”‚   â”‚   â””â”€ buffers.check_timeout() â†’ dropped
  â”‚   â”‚   â””â”€ è¨ˆç®— reward
  â”‚   â””â”€ æ¢¯åº¦æ›´æ–°
  â””â”€ å„²å­˜: final_model.zip

ã€è©•ä¼°æµç¨‹ã€‘

evaluate.py
  â”œâ”€ è®€å–: best_model.zip
  â”œâ”€ è®€å–: default_config.yaml
  â”œâ”€ å»ºç«‹: NetworkSlicingEnv (ç›¸åŒè¨­å®š)
  â”œâ”€ åŸ·è¡Œ: model.predict(obs) â†’ æ¨è«– 2000 æ­¥
  â”œâ”€ æ”¶é›†: history list
  â”œâ”€ è¨ˆç®—: KPIs (throughput, latency, violation_rate)
  â”œâ”€ è½‰æ›: history â†’ pandas.DataFrame
  â””â”€ ç¹ªåœ–: plotter.plot_evaluation_results()
      â””â”€ è¼¸å‡º: throughput_time.png, latency_cdf.png, ...

ã€èª¿å„ªæµç¨‹ã€‘

tune_optuna.py
  â”œâ”€ å®šç¾©: search_space (learning_rate, gamma, net_arch, ...)
  â”œâ”€ å®šç¾©: study (TPE Sampler + Median Pruner)
  â””â”€ è¿´åœˆ (100 trials):
      â”œâ”€ trial.suggest_*() â†’ æ¡æ¨£è¶…åƒæ•¸çµ„åˆ
      â”œâ”€ å»ºç«‹: NetworkSlicingEnv (æ–°é…ç½®)
      â”œâ”€ è¨“ç·´: SAC with new hyperparams
      â”œâ”€ è©•ä¼°: 5 å€‹ checkpointsï¼Œè¨ˆç®— mean_reward
      â”œâ”€ trial.report() â†’ å›å ±çµ¦ Optuna
      â”œâ”€ trial.should_prune() â†’ æ±ºå®šæ˜¯å¦çµ‚æ­¢
      â””â”€ è¿”å›: final_mean_reward
  â””â”€ è¼¸å‡º: best_config_optuna.yaml

================================================================================
9. å„æ¨¡çµ„è²¬ä»»æ¸…å–®
================================================================================

æ¨¡çµ„                    è²¬ä»»                    è¼¸å…¥                è¼¸å‡º
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
constants.py            å®šç¾©ç‰©ç†å®šå¾‹            ç„¡                CQI_EFFICIENCY
                                                                 TOTAL_RBS, ...

traffic.py              ç”Ÿæˆéš¨æ©Ÿæµé‡            arrival_rate      num_packets
                                                packet_size       total_bits

channel.py              æ¨¡æ“¬é€šé“è®ŠåŒ–            ç„¡                cqis
                                                                 efficiencies

buffers.py              ç®¡ç†å°åŒ…ä½‡åˆ—            packets            throughput
                                                capacity           latency
                                                                 dropped

base_station.py         åŸ·è¡ŒåŸºåœ°å°æ¨¡æ“¬          action_weights     info_dict
                        (æ•´åˆæ‰€æœ‰çµ„ä»¶)                           (ååã€å»¶é²)

slicing_env.py          æä¾› Gym ä»‹é¢           action             obs, reward
                                                                 done, info

main.py                 ä¸»è¨“ç·´ç¨‹åº              config             models/
                                                                 final_model.zip

evaluate.py             è©•ä¼°æ€§èƒ½                model              KPIs
                        ç”Ÿæˆåœ–è¡¨                config             åœ–è¡¨

tune_optuna.py          è¶…åƒæ•¸æœç´¢              config             best_config
                        (100+ trials)                            .yaml

plotter.py              è¦–è¦ºåŒ–çµæœ              DataFrame          PNG åœ–è¡¨

================================================================================
10. æ¨¡çµ„é–‹ç™¼é †åºå»ºè­°
================================================================================

æŒ‰ç…§ä¾è³´é—œä¿‚ï¼Œå»ºè­°ä»¥ä¸‹é †åºé–‹ç™¼ï¼š

1ï¸âƒ£  constants.py
    - åœ°åŸºï¼Œå¿…é ˆæœ€å…ˆå®Œæˆ
    - å®šç¾©æ‰€æœ‰ç‰©ç†å¸¸æ•¸èˆ‡ CQI æŸ¥è¡¨

2ï¸âƒ£  traffic.py, channel.py, buffers.py
    - ç¨ç«‹çµ„ä»¶ï¼Œå¯ä¸¦è¡Œé–‹ç™¼
    - traffic.pyï¼šPoisson æµé‡ç”Ÿæˆ
    - channel.pyï¼šCQI æ³¢å‹•æ¨¡æ“¬
    - buffers.pyï¼šFIFO ä½‡åˆ—èˆ‡è¶…æ™‚

3ï¸âƒ£  base_station.py
    - æ•´åˆä¸Šè¿° 3 å€‹çµ„ä»¶
    - å¯¦ç¾ç‰©ç†å±¤å®¹é‡è¨ˆç®—

4ï¸âƒ£  slicing_env.py
    - Gym ç’°å¢ƒåŒ…è£
    - çå‹µå‡½æ•¸è¨­è¨ˆ

5ï¸âƒ£  main.py, evaluate.py, tune_optuna.py
    - æ‡‰ç”¨å±¤
    - å¯ä¸¦è¡Œé–‹ç™¼

6ï¸âƒ£  plotter.py
    - æœ€å¾Œè¦–è¦ºåŒ–
    - ç¾åŒ–è¼¸å‡ºåœ–è¡¨

================================================================================
11. æ¨¡çµ„äº’å‹•ç¯„ä¾‹
================================================================================

================================================================================
11.1 å–®å€‹ TTI ä¸­çš„å®Œæ•´å‘¼å«éˆ
================================================================================

main.py
  model.learn(...):
    for timestep in range(200000):
        obs = env.reset() if done else obs
        
        # â†“ slicing_env.py
        action = model.predict(obs)
        obs_next, reward, done, info = env.step(action)
            
            # â†“ base_station.py
            info = self.bs.step(action)
            
                # â†“ traffic.py
                num_pkts, bits = self.traffic_embb.step()
                
                # â†“ channel.py  
                cqis = self.channel.step()
                eff = get_efficiency(cqis[0])
                
                # â†“ buffers.py
                self.buffer_embb.add_packet(bits, time)
                tx_bits, delays = self.buffer_embb.remove_packets(cap, time)
                dropped = self.buffer_urllc.check_timeout(time)
                
                # â†‘ å›åˆ° base_station.py
                throughput = tx_bits / TTI_DURATION
                latency = mean(delays)
                
            # â†‘ å›åˆ° slicing_env.py
            reward = w_thr Ã— throughput - w_lat Ã— latency - penalty Ã— dropped
            obs_next = [buffer_load, hol, cqi, ...]
        
        # â†‘ å›åˆ° main.py
        agent.replay_buffer.add(obs, action, reward, obs_next, done)
        agent.train_step()

================================================================================
11.2 çå‹µè¨ˆç®—è©³ç´°ç¯„ä¾‹
================================================================================

è¨­å®šï¼š
  - eMBB ååé‡ï¼š246 Mbps
  - URLLC ååé‡ï¼š88 Mbps
  - URLLC å¹³å‡å»¶é²ï¼š0.4 ms
  - URLLC ä¸ŸåŒ…ï¼š0
  - w_throughput = 0.1 (Mbps çš„æ¬Šé‡)
  - w_latency = 10.0 (ms çš„æ¬Šé‡)
  - drop_penalty = 50.0 (å€‹åˆ¥ä¸ŸåŒ…çš„æ‡²ç½°)

è¨ˆç®—ï¼š
  total_throughput = 246 + 88 = 334 Mbps
  reward_throughput = 0.1 Ã— 334 = 33.4
  
  latency_ms = 0.4 ms
  reward_latency = 10.0 Ã— 0.4 = 4.0
  
  reward_drop = 50 Ã— 0 = 0
  
  final_reward = 33.4 - 4.0 - 0 = 29.4

è§£é‡‹ï¼š
  - ååé‡å¥½ï¼Œç²å¾— 33.4 é»çå‹µ âœ“
  - å»¶é²ä¸éŒ¯ (0.4ms << 1ms)ï¼Œåƒ…æ‰£ 4 é» âœ“
  - æ²’æœ‰ä¸ŸåŒ…ï¼Œç„¡æ‡²ç½° âœ“

================================================================================
11.3 è³‡æºåˆ†é…ç¯„ä¾‹
================================================================================

è¨­å®šï¼š
  - Agent å‹•ä½œï¼š[w_eMBB=0.6, w_URLLC=0.4]
  - ç¸½ RBsï¼š273

è¨ˆç®—ï¼š
  æ­£è¦åŒ–ï¼šw_eMBB=0.6, w_URLLC=0.4 (å·²ç‚º normalized)
  
  RB åˆ†é…ï¼š
    num_rbs_embb = int(273 Ã— 0.6) = 163 RBs
    num_rbs_urllc = 273 - 163 = 110 RBs
  
  é€šé“ç‹€æ…‹ï¼š
    CQI_eMBB = 13 â†’ efficiency_embb = 4.52 bits/symbol
    CQI_URLLC = 10 â†’ efficiency_urllc = 2.73 bits/symbol
  
  å®¹é‡è¨ˆç®—ï¼š
    cap_embb = 163 Ã— 168 Ã— 4.52 Ã— 0.86 = 106,234 bits
    cap_urllc = 110 Ã— 168 Ã— 2.73 Ã— 0.86 = 43,445 bits
  
  è½‰æ›ç‚ºé€Ÿç‡ (bits/TTI â†’ Mbps)ï¼š
    throughput_embb = 106,234 / 0.0005 / 1e6 = 212.5 Mbps
    throughput_urllc = 43,445 / 0.0005 / 1e6 = 86.9 Mbps

================================================================================
æ¨¡çµ„åŒ–è¨­è¨ˆçš„å„ªå‹¢
================================================================================

âœ… ç¨ç«‹æ¸¬è©¦
   - æ¯å€‹æ¨¡çµ„å¯å–®ç¨é€²è¡Œ unit test
   - ä¾‹ï¼štraffic.py å¯ç¨ç«‹é©—è­‰ Poisson æ¡æ¨£çš„æ­£ç¢ºæ€§

âœ… å¿«é€Ÿè¿­ä»£
   - ä¿®æ”¹ä¸€å€‹æ¨¡çµ„ä¸å½±éŸ¿å…¶ä»–
   - ä¾‹ï¼šæ”¹è®Š CQI æ¨¡å‹åªéœ€ä¿®æ”¹ channel.py

âœ… æ˜“æ–¼æ“´å±•
   - åŠ å…¥æ–°çš„æ’ç¨‹ç­–ç•¥ã€æµé‡é¡å‹ã€é€šé“æ¨¡å‹
   - ä¾‹ï¼šæ”¯æ´ 3+ å€‹åˆ‡ç‰‡åªéœ€æ“´å±• base_station.py

âœ… è«–æ–‡é‡ç¾
   - é…ç½®æª”å®Œå…¨æŒ‡å®šå¯¦é©—æ¢ä»¶
   - å…¶ä»–ç ”ç©¶è€…å¯ç”¨å®Œå…¨ç›¸åŒçš„åƒæ•¸é‡ç¾çµæœ

================================================================================
çµè«–
================================================================================

æ­¤å°ˆæ¡ˆé€éæ¨¡çµ„åŒ–è¨­è¨ˆï¼Œå¯¦ç¾äº†ï¼š

1. æ¸…æ™°çš„è·è²¬åˆ†å·¥ï¼š
   - ç‰©ç†å±¤ï¼štraffic, channel, buffers, base_station
   - RL å±¤ï¼šslicing_env
   - æ‡‰ç”¨å±¤ï¼šmain, evaluate, tune_optuna

2. å®Œæ•´çš„æ•¸æ“šæµï¼š
   é…ç½® â†’ ç‰©ç†å±¤ â†’ RL ç’°å¢ƒ â†’ è¨“ç·´/è©•ä¼°/èª¿å„ª

3. å¯é‡è¤‡çš„å¯¦é©—ï¼š
   æ‰€æœ‰åƒæ•¸åœ¨ YAMLï¼Œæ˜“æ–¼ç‰ˆæœ¬æ§åˆ¶èˆ‡è«–æ–‡é™„éŒ„

4. å¯æ“´å±•çš„æ¶æ§‹ï¼š
   è¼•é¬†æ”¯æ´æ–°çš„é€šé“æ¨¡å‹ã€æµé‡é¡å‹ã€æ’ç¨‹ç­–ç•¥

================================================================================
